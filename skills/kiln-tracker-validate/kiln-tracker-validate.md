---
name: kiln-tracker-validate
description: 'Validate stage tracker — single step, report, shut down'
---

## Overview
This skill executes exactly one pipeline step: `VALIDATE`. It is spawned by `kiln-fire` as a fresh teammate for each validation invocation. It reads `.kiln/STATE.md` from disk, runs plan gate checks for the active phase, writes validation artifacts, reports completion, and shuts down.

## Single-Step Dispatcher Contract

When spawned by `kiln-fire`, this skill executes exactly ONE step:

1. Read `.kiln/STATE.md` from disk to determine the active phase and step.
2. Execute exactly that step (see Stage Details below).
3. Write artifacts to `.kiln/tracks/phase-N/`.
4. SendMessage `{ stage: "track:<phase>:<step>", status: "completed", evidence_paths: [...] }` to team lead.
5. Shut down.

Hard rules:
- **Do not write or edit `.kiln/STATE.md`.** Only `kiln-fire` writes STATE.md.
- **Do not advance `currentStep` or `currentPhase`.** That is `kiln-fire`'s responsibility.
- **Do not loop to the next step.** Execute one step, report, shut down.

Context Freshness: This skill follows the four-step ephemeral invariant defined in
`skills/kiln-core/kiln-core.md` § Context Freshness Contract:
spawn fresh → read from disk → do one job → write to disk → die.

## Stage Details

### Purpose
Quality-gate the phase plan using the 7-dimension validation contract.

### Subagent Behavior By Mode
- `preferences.useTeams: false|absent`: spawn `kiln-validator`.
- `preferences.useTeams: true` + `modelMode: "multi-model"`: consume `plan-validation-result` sentinel from PLAN team validator task.
- `preferences.useTeams: true` + `modelMode: "claude-only"`: spawn `kiln-validator` (no PLAN-team sentinel exists in this mode).

### Teams Mode Gate Contract (`useTeams: true`, `modelMode: "multi-model"`)
- Do not spawn a second validator by default.
- Read `plan-validation-result` generated by `phase-N:plan:validator`.
- Required sentinel keys: `sentinel`, `phase`, `status`, `validator`, `plan_path`, `checks`.
- Missing criteria: any required key absent.
- Malformed criteria:
  - `status` is not exactly `pass` or `fail`.
  - `phase` is not exactly the active `phase-N`.
  - `checks` is not a structured checks collection.
  - `plan_path` is not canonical for this phase.
- Canonical `plan_path` rule: after path normalization, it must resolve to `.kiln/tracks/phase-N/PLAN.md` (absolute equivalent to the same file is allowed).
- Stale criteria: sentinel phase mismatch or path resolves outside the active phase folder.

Gate decision table:
| Condition | Decision |
| --- | --- |
| Sentinel missing, malformed, stale, or `status: fail` | VALIDATE `FAIL` and route to planning correction path |
| Sentinel valid with `status: pass` | VALIDATE `PASS` and advance to `EXECUTE` |

When `useTeams: true` and `modelMode: "claude-only"`:
- PLAN used non-Teams flow, so no sentinel is expected.
- Spawn `kiln-validator` directly with canonical plan inputs.

### Validation Contract
- Run all 7 dimensions from kiln-plan validation requirements.
- Emit machine-readable `plan-validation-result` sentinel.

### Pass Behavior
- Mark validation as passed.
- Advance phase step to `EXECUTE`.

### Fail Behavior
- Route validator findings back to planning.
- Re-trigger planning with findings attached.
- Allow at most 2 re-plan attempts per phase.
- After second failed validation cycle, `HALT`.

### State Updates (Reported To `kiln-fire`)
- Increment `planValidationAttempts` per phase.
- Persist failure reasons and validator artifact path.
- Record validation transition timestamps.

## References
- `skills/kiln-core/kiln-core.md` — shared contracts, state schema, model routing, Context Freshness Contract
