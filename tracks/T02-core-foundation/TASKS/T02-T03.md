# T02-T03: Write STATE.md template

## GOAL
Create the STATE.md template that defines the progress tracking format for .kiln/STATE.md — the persistent state file that survives session restarts and context resets.

## ACCEPTANCE_CRITERIA
- AC-03 (DET): `templates/STATE.md.tmpl` exists and contains required sections: phase list, current track step, correction cycle counts, regression test count

## FILES
- path: templates/STATE.md.tmpl
  action: add
  rationale: Template for .kiln/STATE.md — the persistent progress tracker read by orchestrator and status command

## COMMANDS
- `test -f templates/STATE.md.tmpl` — file exists
- `grep -c '##' templates/STATE.md.tmpl` — has multiple sections

## SUMMARY
Create the file `templates/STATE.md.tmpl`. This is a markdown template that defines the format of `.kiln/STATE.md` — the persistent progress tracking file for the kiln workflow. It is created by `/kiln:init` and updated by the orchestrator after each stage transition. It is read by the on-session-start hook to rehydrate state after a session restart, and by the `/kiln:status` slash command to display progress.

**Context for the implementer:** Kiln is a multi-phase code generation pipeline. Each phase ("track") goes through stages: plan -> validate -> execute -> e2e -> review -> reconcile. STATE.md tracks where we are in this pipeline so that work can resume after session restarts or context resets. The `templates/` directory already exists. Place this file at `templates/STATE.md.tmpl`.

Write this exact markdown content to the file:

```markdown
# Kiln — Project State

## Project

- **Name:** {{project_name}}
- **Model Mode:** {{model_mode}}
- **Initialized:** {{init_timestamp}}

## Phase Progress

<!-- Populated when roadmap is generated. One row per phase. -->

| Phase | Title | Status |
|-------|-------|--------|
<!-- Example:
| 1 | Project scaffolding | complete |
| 2 | Core data model | in-progress |
| 3 | Authentication | pending |
-->

## Current Track

- **Phase:** {{current_phase_number}} — {{current_phase_title}}
- **Step:** {{current_step}}
- **Step Status:** {{step_status}}
- **Started:** {{step_started_timestamp}}

<!-- Valid steps: plan | validate | execute | e2e | review | reconcile -->
<!-- Valid step statuses: pending | in-progress | complete | failed -->

## Correction Cycles

- **Mini-verify retries (current task):** {{mini_verify_retries}}/2
- **E2E correction cycles (current track):** {{e2e_corrections}}/3
- **Code review correction cycles (current track):** {{review_corrections}}/3

<!-- Mini-verify resets per task. E2E and review corrections reset per track. -->
<!-- If any counter reaches its max, the pipeline HALTs and escalates to operator. -->

## Regression Suite

- **Total E2E tests:** {{regression_test_count}}
- **From phases:** {{completed_phase_count}} completed

<!-- Grows as each track adds E2E tests. All prior tests run as regression. -->

## Session Recovery

- **Last Activity:** {{last_activity_timestamp}}
- **Last Completed:** {{last_completed_action}}
- **Next Expected:** {{next_expected_action}}

<!-- Used by on-session-start hook to detect interrupted sessions and provide resume instructions. -->
<!-- Example:
- Last Activity: 2026-02-14T15:30:00Z
- Last Completed: Phase 3 — E2E verification passed
- Last Completed: Phase 3 — Begin code review
-->
```

Use `{{placeholder}}` syntax for all runtime values. Keep the HTML comments as guidance — they explain the format to agents that read/write this file. The comments help agents understand valid values and reset rules. Target ~65 lines.

## ESTIMATED_DIFF
~65 lines

## RISKS
- Missing sections would break the on-session-start hook's state rehydration (Track T09)
- If the format is ambiguous, agents will parse it inconsistently
- Placeholder names must be consistent — agents will use string matching to find/replace values

## ROLLBACK
- git revert <task commit>
