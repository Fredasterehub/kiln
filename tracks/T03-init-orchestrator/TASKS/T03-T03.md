# T03-T03: Write /kiln:status skill

## GOAL
Write the /kiln:status slash command skill that reads project state and displays a formatted progress report with intelligent next-action routing.

## ACCEPTANCE_CRITERIA
- AC-03 (LLM): Reads STATE.md and ROADMAP.md. Displays phase progress with statuses. Shows correction cycle counts and regression suite size. Routes to next action with specific command suggestion.

## FILES
- path: skills/kiln-status/kiln-status.md
  action: add
  rationale: The /kiln:status slash command — progress reporting and next-action routing

## COMMANDS
- `test -f skills/kiln-status/kiln-status.md` — file exists
- `wc -l skills/kiln-status/kiln-status.md` — should be ~120-180 lines

## SUMMARY
Create the file `skills/kiln-status/kiln-status.md`. This is a Claude Code skill file loaded when a user types `/kiln:status`. It reads kiln's state files and displays a formatted progress report.

**Context for the implementer:** Kiln stores all its state in a `.kiln/` directory at the project root. The two key files for status are:
- `.kiln/STATE.md` — tracks current phase, step, correction cycles, regression test count, session recovery info
- `.kiln/ROADMAP.md` — lists all phases with their titles

The status command reads these files, formats a human-readable progress display, and tells the user what to do next.

Start the file with this YAML frontmatter:

```yaml
---
name: kiln-status
description: Display kiln project progress and route to next action
user_invocable: true
---
```

Then write heading `# /kiln:status — Project Status` followed by these sections:

### Section 1: Prerequisites Check

Write heading `## Prerequisites`. Content:

"Before displaying status, verify kiln is initialized:
1. Check if `.kiln/` directory exists. If not: print 'Kiln is not initialized for this project. Run /kiln:init first.' and stop.
2. Check if `.kiln/STATE.md` exists. If not: print 'Kiln state file missing. Run /kiln:init to reinitialize.' and stop.
3. Read `.kiln/config.json` to get project settings."

### Section 2: Gather State

Write heading `## Step 1: Read State Files`. Content:

"Read these files using the Read tool:
1. `.kiln/STATE.md` — parse the following fields:
   - Project name (from Project section)
   - Model mode (from Project section)
   - Phase Progress table (list of phases with statuses)
   - Current Track section (phase number, step, step status)
   - Correction Cycles section (mini-verify retries, E2E corrections, review corrections)
   - Regression Suite section (test count, phase count)
   - Session Recovery section (last activity, last completed, next expected)

2. `.kiln/ROADMAP.md` — if it exists, read phase titles. If it doesn't exist yet (pre-roadmap), note that roadmap hasn't been generated.

3. `.kiln/config.json` — read model mode and tooling detection results."

### Section 3: Display Format

Write heading `## Step 2: Display Status`. Content:

"Format and display the status report. Use this exact format:

```
╔══════════════════════════════════════╗
║         Kiln Project Status          ║
╠══════════════════════════════════════╣

  Project:  <project_name>
  Mode:     <multi-model | claude-only>

  ── Phases ──────────────────────────

  <For each phase in roadmap/STATE.md:>
  Phase <N>: <title>          [<status>]
  <where status is one of: completed ✓, in-progress ►, failed ✗, pending ·>

  Example:
  Phase 1: Project scaffolding     [completed ✓]
  Phase 2: Core data model         [completed ✓]
  Phase 3: Authentication          [in-progress ►] (review)
  Phase 4: API endpoints           [pending ·]

  ── Current Track ───────────────────

  Phase <N>: <title>
  Step:  <plan|validate|execute|e2e|review|reconcile> (<status>)
  Corrections: <E2E_count>/3 E2E, <review_count>/3 review

  ── Regression Suite ────────────────

  <test_count> tests from <phase_count> completed phases

  ── Tooling ─────────────────────────

  Test runner:   <value or 'none'>
  Linter:        <value or 'none'>
  Type checker:  <value or 'none'>
  Start command: <value or 'none'>

╚══════════════════════════════════════╝
```

If the roadmap hasn't been generated yet, show:
```
  ── Phases ──────────────────────────
  Roadmap not generated yet.
```

If no phases exist yet (pre-brainstorm), show only Project/Mode and the next action."

### Section 4: Next Action Routing

Write heading `## Step 3: Route to Next Action`. Content:

"Based on the current state, print ONE of these next-action messages:

**No .kiln/VISION.md exists:**
'Next: Run /kiln:brainstorm to start the brainstorming session.'

**VISION.md exists but no ROADMAP.md:**
'Next: Run /kiln:roadmap to generate the implementation roadmap.'

**ROADMAP.md exists but no track has started:**
'Next: Run /kiln:track to start building.'

**A track is in progress (step status = in-progress):**
'Phase <N> is currently at the <step> stage. Run /kiln:track to resume.'

**A track has failed (step status = failed):**
'Phase <N> halted at <step> after <count> correction cycles. Review .kiln/tracks/phase-<N>/<results_file> for details. Options: fix manually and resume, adjust criteria, or replan.'

**All phases complete but no FINAL_REPORT.md:**
'All phases complete. Final integration E2E pending. Run /kiln:track to trigger final verification.'

**FINAL_REPORT.md exists:**
'Project complete! See .kiln/FINAL_REPORT.md for the full test report.'

**For quick tasks:**
Also mention: 'For small changes, use /kiln:quick \"description\".'

Always end with: 'Edit .kiln/config.json to adjust preferences.'"

### Section 5: Edge Cases

Write heading `## Edge Cases`. Content:

"- If STATE.md is corrupted or unparseable: print 'Warning: STATE.md appears corrupted. Consider running /kiln:init to reinitialize.' Show whatever info can be extracted.
- If ROADMAP.md references phases not in STATE.md: show phases from ROADMAP.md with status 'unknown'.
- If session recovery shows a stale timestamp (>24 hours old): add a note 'Previous session was interrupted. State may need review.'"

Target ~150 lines.

## ESTIMATED_DIFF
~150 lines

## RISKS
- STATE.md format must match exactly what the orchestrator writes — any mismatch breaks parsing
- Display format must work in terminal with monospace font (no emoji that breaks alignment)
- Edge cases around partially initialized projects could cause crashes

## ROLLBACK
- git revert <task commit>
