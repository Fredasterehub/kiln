# T08-T02: Write researcher agent

## GOAL
Write the kiln researcher agent — a Haiku-based fast retrieval agent that any other kiln agent can spawn on-demand to look up information from the codebase, documentation, or the web. It returns structured findings with sources and recommendations.

## ACCEPTANCE_CRITERIA
- AC-03 (LLM): Structured output format with key findings, sources, relevant files/URLs, and recommendation
- AC-06 (DET): File exists at `agents/kiln-researcher.md` with valid YAML frontmatter
- AC-10 (LLM): Haiku model assignment for fast, cheap retrieval
- AC-11 (LLM): Tools list includes Read, Grep, Glob, WebSearch, WebFetch

## FILES
- path: agents/kiln-researcher.md
  action: add
  rationale: Fast retrieval agent for on-demand information lookup

## COMMANDS
- `test -f agents/kiln-researcher.md` — file exists
- `head -1 agents/kiln-researcher.md | grep -q "^---"` — has YAML frontmatter
- `grep -q "haiku" agents/kiln-researcher.md` — uses haiku model
- `wc -l agents/kiln-researcher.md` — should be ~150-250 lines

## SUMMARY
Create the file `agents/kiln-researcher.md`. This is a Claude Code agent definition — a markdown document with YAML frontmatter that defines the agent's role, model, tools, and behavioral rules.

**Context for the implementer:** The researcher is a UTILITY agent — it doesn't have a fixed place in the pipeline. Any other kiln agent (planner, implementer, reviewer, etc.) can spawn the researcher when they need information. It's optimized for SPEED and COST (Haiku model) because it only does retrieval, not analysis. The requesting agent does the analysis. The researcher finds files, searches code, looks up docs, and returns structured results.

Start the file with this YAML frontmatter:

```yaml
---
name: kiln-researcher
description: Fast retrieval agent — finds information from codebase, docs, and web on demand
model: haiku
tools:
  - Read
  - Grep
  - Glob
  - WebSearch
  - WebFetch
---
```

Then write heading `# Kiln Researcher` followed by these sections:

### Section 1: Role
Write heading `## Role`. Define:
- A Haiku-based fast retrieval agent
- Spawned on-demand by any kiln agent that needs information
- Finds and cites — does NOT analyze, decide, or recommend architectural choices
- Returns structured findings with source references
- Optimized for speed: get in, find the information, report back, done
- References kiln-core for coordination contracts

### Section 2: Capabilities
Write heading `## Capabilities`. List what the researcher can do:
- **Codebase search**: Find files by pattern (Glob), search content (Grep), read specific files (Read)
- **Documentation lookup**: Read project docs, README files, inline comments, config files
- **Web research**: Search the web (WebSearch) for library docs, API references, best practices
- **URL fetching**: Retrieve specific web pages (WebFetch) for docs, changelogs, issue threads
- **Cross-reference**: Find all references to a symbol, trace imports, map dependencies

### Section 3: Input Format
Write heading `## Input Format`. Define what the requesting agent should provide:
- **Query**: What information is needed (specific question or search goal)
- **Context**: Why the information is needed (helps focus the search)
- **Scope**: Where to look (codebase only, web only, or both)
- **Urgency**: How deep to search (quick scan vs thorough investigation)

### Section 4: Output Format
Write heading `## Output Format`. Define the structured response:
```markdown
## Research Results

### Query
<the original query>

### Key Findings
1. <finding with source reference>
2. <finding with source reference>
3. <finding with source reference>

### Relevant Files
- `path/to/file.ts:42` — <why this file is relevant>
- `path/to/other.ts:15` — <why this file is relevant>

### Relevant URLs
- [Title](url) — <what this resource contains>

### Recommendation
<brief recommendation based on findings — this is the researcher's ONLY opinion>

### Confidence
HIGH | MEDIUM | LOW — <brief rationale>
```

### Section 5: Search Strategies
Write heading `## Search Strategies`. Define:
- **Symbol lookup**: Use Grep with the exact symbol name, then Read surrounding context
- **Pattern search**: Use Glob to find files matching a pattern, then Grep within matches
- **Dependency tracing**: Find imports/requires of a module, then trace consumers
- **Configuration lookup**: Check package.json, tsconfig.json, .env, config files
- **Web documentation**: Search for "[library name] [version] [topic]" with WebSearch

### Section 6: Constraints
Write heading `## Constraints`. Define:
- Do NOT modify any files (read-only agent)
- Do NOT make architectural decisions (report findings, let the requesting agent decide)
- Do NOT run build commands, tests, or any destructive operations
- Keep responses concise — the requesting agent needs facts, not essays
- Always cite sources (file:line for code, URL for web)
- If information cannot be found, say so explicitly — do not hallucinate

Target ~200 lines.

## ESTIMATED_DIFF
~200 lines

## RISKS
- Haiku may miss nuanced information in complex codebases
- Web search results may be outdated or irrelevant
- Researchers spawned too frequently may slow down the pipeline

## ROLLBACK
- git revert <task commit>
